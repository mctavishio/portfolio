<!DOCTYPE html>
<html lang="en">
<head>
	<title>migrations</title>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
	<meta name="description" content="photosynthesis" />
	<meta name="author" content="kathy mctavish">
	<!-- from ::: http://www.favicon-generator.org/ -->
	<link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="192x192"  href="../android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
	<link rel="manifest" href="../manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff">

	<!-- JSON-LD : Google -->
	<script type="application/ld+json">
		{
			"@context": "http://schema.org",
			"@type": "WebPage",
			"name": "photosynthesis",
			"breadcrumb": "mctavish.studio > blue atlas > photosynthesis",
          		"url": "http://www.mctavish.studio/blueatlas/green.html",
			"description": "night sky",
			"datePublished": "Wed Nov 18 2020 12:10:53 GMT-0500 (Central Daylight Time)",
          		"image": "http://www.mctavish.io/data/mctavishIcon-01-04-01-01-01.png",
			"author": "http://mctavish.io",
			"license": "http://creativecommons.org/licenses/by-nc-sa/3.0/us/deed.en_US"
		}
	</script>
	<link rel="stylesheet" href="../css/fieldnotes.css"/>
	<style>
		html {
			font-family: 'Trebuchet MS', Tahoma, Verdana, Helvetica, Arial, Tahoma, 'Trebuchet MS', sans-serif;
			font-family: var(--sans);
		}
		article h1 {
			font-family: Helvetica, Arial, Tahoma, 'Trebuchet MS', sans-serif;
			font-family: var(--sans);
			font-size: 1.4em;
		}
		main ul.stanza li {
			font-weight: normal;
		}
		main article:nth-child(odd) a:before {
			color: #fcfbe3;
			color: var(--warmwhite);
			content: ": ";
		}
		main article:nth-child(even) a:before {
			color: #000000;
			color: var(--warmblack);
			content: ": ";
		}
		a {
			text-decoration: none;
		}
		a:hover {
			background-color: #7B8DA6;
		}
		main a:before {
			color: #fcfbe3;
			color: var(--warmgray);
			content: ". ";
		}
		main a:after {
			color: #fcfbe3;
			color: var(--warmwhite);
			content: " .";
		}
		main {
			max-width: 900px;
		}
		video {
			object-fit: cover;
			width: 100vw;
			height: 100vh;
			position: fixed;
			top: 0;
			left: 0;
		}

	</style>
</head>
<body id="top" >
<div id="videoframe" class="frame zlowest">
	<video playsinline autoplay muted loop id="video1">
	  <!-- <source src="https://storage.googleapis.com/www.blueboatfilms.com/film/walkingstark.mp4" type="video/mp4"> -->
	  <source src="https://storage.cloud.google.com/www.blueboatfilms.com/film/bluewalking202011.mov" type="video/mp4">
	</video>
</div>
<div id="svgframe" class="frame zlow"><svg xmlns="http://www.w3.org/2000/svg" id="svg" class="frame"></svg></div>
<div id="wordframe" class="frame z0"></div>
<div id="subtextframe" class="frame z0"></div>
<div id="contentframe" class="absolute zhighest" style="opacity:0">
<div id="mainflex">
<main id="main" class="expand" data-state="expanded">	
<header>
	<h1>migrations</h1>
	<h2>text by sheila packa</h2>
</header>
<!-- <ul data-role="narrator" class="info compress">
	<li class="title typewriter" title="telegraph" id="telegraph"></li>
	<li class="title  typewriter" title="clock" id="clock">here | now</li>
</ul> -->
<ul data-role="narrator" class="info expand">
	<li><a href="#" id="soundlink" class="corelink">turn on sound</a></li>
	<li><a href="index.html" id="homelink" class="corelink">return home</a></li>
</ul>
<article class="poem" >
	<header>
	<h1><a href="#top">^</a></h1><!--dream-->
	</header>
	<div class="textContent">
		<ul class="stanza">
			<li>two wild swans</li>
			<li>came in the dark hours</li>
			<li>by star light far into the journey</li>
			<li>to lend their wings</li>
			</ul>
			<ul class="stanza">
			<li>traveled north over ten rivers</li>
			<li>flew over moss riven</li>
			<li>boulders broken from the mother stone</li>
		</ul>
		<ul class="stanza">
			<li>over the fens</li>
			<li>and spears of birch</li>
			<li>through the wordless</li>
			<li>winds and migrations</li>
			<li>flew over graves</li>
			<li>and lovers reaching blindly</li>
			<li>through sheets of northern lights</li>
		</ul>
		<ul class="stanza">
			<li>two swans with feathers of falling snow</li>
		</ul>
	</div>
</article>
<article class="poem" >
	<header>
	<h1><a href="#top">^</a> </h1> <!--twelve tone geese-->
	</header>
	<div class="textContent">
		<ul class="stanza">
			<li>in synchrony and angles</li>
			<li>&nbsp;across forests</li>
			<li>&nbsp;&nbsp;over rivers</li>
			<li>&nbsp;&nbsp;&nbsp;below Venus or</li>
			<li>&nbsp;&nbsp;&nbsp;&nbsp;clouds invisible borders</li>
			<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carrying nothing</li>
			<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;besides star memories</li>
			<li>&nbsp;&nbsp;&nbsp;&nbsp;along arteries of the body</li>
			<li>&nbsp;&nbsp;&nbsp;into dark interiors</li>
			<li>&nbsp;&nbsp;through the moon's phases</li>
			<li>&nbsp;calling to each other</li>
			<li>on lovers' endless roads</li>
		</ul>
	</div>
</article>
<article class="poem" >
	<header>
	<h1><a href="#top">^</a></h1> <!--north and south-->
	</header>
	<div class="textContent">
		<ul class="stanza">
			<li>if you answer</li>
			<li>when you hear their call</li>
		</ul>
		<ul class="stanza">
			<li>geese in loose and shifting lines</li>
			<li>from land to sea to cloud</li>
		</ul>
		<ul class="stanza">
			<li>cross the evening sun red</li>
			<li>on clouds of plum</li>
			<li>and rivers inlaid in gold and flowing</li>
			<li>upon the slopes</li>
		</ul>
		<ul class="stanza">
			<li>cross a border</li>
			<li>if you need to leave</li>
		</ul>
		<ul class="stanza">
			<li>in every country</li>
			<li>we are born to the same body</li>
		</ul>
		<ul class="stanza">
			<li>wind inimitable</li>
			<li>invisible forces change us</li>
			<li>beyond reach</li>
		</ul>
		<ul class="stanza">
			<li>if you make the sky your home</li>
		</ul>
		<ul class="stanza">
			<li>—it isn't easy, you can't bring</li>
			<li>those things—</li>
		</ul>
		<ul class="stanza">
			<li>wrap in those lines</li>
			<li>cross with them</li>
		</ul>
	</div>
</article>
<article class="poem" >
	<header>
	<h1><a href="#top">^</a></h1><!--a journey yes-->
	</header>
	<div class="textContent">
		<ul class="stanza">
			<li>wind turns the body</li>
			<li>and ground falls away</li>
		</ul>
		<ul class="stanza">
			<li>geese unafraid of silence</li>
			<li>or empty sky</li>
			<li>must go must go must go</li>
		</ul>
		<ul class="stanza">
			<li>reach into the wind</li>
			<li>move as clouds rimmed with sunlight</li>
			<li>or dark cloud of rain</li>
		</ul>
		<ul class="stanza">
			<li>need to follow their flight</li>
			<li>like ice in the spring</li>
			<li>that once held the river</li>
		</ul>
		<ul class="stanza">
			<li>light surges in the veins</li>
			<li>searches for the beginning</li>
			<li>of a journey yes</li>
		</ul>
		<ul class="stanza">
			<li>music you haven't heard</li>
			<li>didn't know you needed</li>
			<li>opens deep</li>
		</ul>
	</div>
</article>
<audio loop=true id="audio1">
  <!-- <source src="http://www.blueboatfilms.com/sound/starfallremix.mp3" type="audio/mpeg"> -->
  <!-- <source src="https://storage.cloud.google.com/www.blueboatfilms.com/sound/starfallremix.mp3" type="audio/mpeg"> -->
  <source src="https://storage.cloud.google.com/www.blueboatfilms.com/sound/nyx3.mp3" type="audio/mpeg">
  Your browser does not support the audio tag.
</audio>
</main>
</div>
</div>
</body>
<script src="../code/velocity.min.js"></script>
<script src="../code/kefir201911.min.js"></script>
<!-- <script src="code/atlasabsence.js"></script> -->
<script>
let width = window.innerWidth, height = window.innerHeight;
let min = Math.min(width, height), max = Math.max(width, height);
let version = (min < 680 || max < 980) ? "small" : "large";
let v = version === "small" ? 0 : 1;
let z = {};
z.tools = {
	randominteger: (min, max) => {
		return Math.floor( min + Math.random()*(max-min));
	},
	logmsg: function(msg) {
		try { 
			console.log("### ::: " + msg); 
		}
		catch(err) { z.tools.logerror(err) }
	},
	logerror: function(error) {
		try { console.log("rusty error ... " + error); }
		catch(err) {}
	},
	randomhighharmonic: () => {
		let multipliers = [10.0, 12.5, 13.33, 15, 20];
		return multipliers[ z.tools.randominteger( 0, multipliers.length) ];
	},
	randomharmonic: () => {
		let multipliers = [5, 7.5, 10.0, 12.5, 13.33, 15, 20];
		return multipliers[ z.tools.randominteger( 0, multipliers.length) ];
	},
	randomlowharmonic: () => {
		let multipliers = [5, 7.5, 10.0, 12.5, 13.33, 15, 20];
		return multipliers[ z.tools.randominteger( 0, multipliers.length) ]/2;
	},
	randomkey: (object) => {
		let keys = Object.keys(object);
		let key = keys[z.tools.randominteger(0,keys.length)];
		// z.tools.logmsg("key = " + key);
		return key;
	},
	datestr: (date, options) => {
		if(options===undefined) options = {year: "numeric", month: "2-digit", day: "numeric", hour12: true, hour: "2-digit", minute: "2-digit", second: "2-digit"};
		return date.toLocaleTimeString("en-US", options);
		//new Date().toLocaleTimeString("en-US", {year: "numeric", month: "2-digit", day: "numeric", hour12: true, hour: "2-digit", minute: "2-digit", second: "2-digit"});
	},
	togrid: (min=1, max=1, x=1, ndivisions=1) => {
		let dx = Math.floor( (max-min) / ndivisions );
		return Math.floor( ( x-min+dx/2)/dx )*dx + min;
	},
};
//core elements
z.elements = ( () => {
	return {
		body: { el: document.querySelector("body") },
		main: { el: document.querySelector("main") },
		// clock: { el: document.querySelector("#clock") },
		// telegraph: { el: document.querySelector("#telegraph") },
		svg:  { el: document.querySelector("#svg") },
		frames: ["subtextframe", "svgframe", "wordframe", "contentframe"].reduce( (acc, id) => {
			z.tools.logmsg("create frame element ::: " + id);
			acc[id] = { el: document.querySelector("#"+id) };
			return acc;
		}, {}),
	}
})()
	
z.streams = {
	clock: ( () => {
	let dt = 1;
	let date0 = new Date();
	let t0 = Math.floor(date0.getTime()/1000);
	let state0 = { dt: dt, count: 0, date: date0, t: t0, t0: t0 };
	return Kefir.withInterval( dt*1000, emitter => { emitter.emit( { date: new Date() } ) })
			.scan( (state, e) => { 
				state.date = e.date;
				state.t = Math.floor(e.date.getTime()/1000);
				state.count = state.count + 1;
				return state;
			}, state0  )
	})( ),
	dimensions: ( () => {
		let dt = .4;
		const ngrids=[2,2], npasts=[0,0];
		let state0 = { dt: dt, count: 0,
			grid: { nrows: ngrids[v], ncols: ngrids[v], dx: Math.floor(width/ngrids[v]), dy: Math.floor(height/ngrids[v]), sw: 12, pastn: npasts[v] },
			width: width, height: height, 
			max: max, min: min, 
		};
		return Kefir.fromEvents(window, "resize").throttle(dt*1000)
			.scan( (state,e) => {
				state.width = window.innerWidth;
				state.height = window.innerHeight;
				state.max = Math.max(state.width, state.height);
				state.min = Math.min(state.width, state.height);
				state.grid.dx = Math.floor(state.width/state.grid.ncols);
				state.grid.dy = Math.floor(state.height/state.grid.nrows);
				state.grid.sw = Math.floor(Math.max(state.grid.dx*.03, state.grid.dy*.03, 4));
				return state
			}, state0) 
	})( ),
};

z.draw = z => {
	let ntimings = 32;
	let dtiming = Math.floor(400/ntimings);
	const timings = [...Array(ntimings).keys()].reduce( (acc, j) => {
		let duration = 500+(j*dtiming);
		acc[j] = [duration, 900-duration];
	return acc;
	}, []);
	// const timings = [ [380,600], [400,580], [480,500], [500,480], [580,400], [600,380], [640,340], [680,300], [700,280], [740,240], [780,200], [800,180], [840,140], [880,100]];
	// const timings = [ [180,800], [200,780], [280,700], [300,680], [380,600], [400,580], [480,500], [500,480], [580,400], [600,380], [640,340], [680,300], [700,280], [740,240], [780,200], [800,180], [840,140], [880,100]];
	// z.streams["clock"].onValue( e => {
	// 	z.elements["clock"].el.innerHTML = z.tools.datestr(new Date(e.t*1000));
	// });

	const playlist = [
		//primary colors
		// ["#fcfbe3", "#191918"], //"warmbw",
		// ["#9a0000", "#fcfbe3", "#191918"], //"warmbwred",
		// ["#fcfbe3", "#191918"], //"warmbw",
		// ["#ffcc00", "#fcfbe3", "#191918"], //"warmbwyellow",
		// ["#fcfbe3", "#191918"], //"warmbw",
		// ["#006699", "#fcfbe3", "#191918", "#4b4b44"], //"warmbwbluegray",
		// ["#006699", "#fcfbe3", "#191918", "#004488"], //"warmbwbluegray",
		// ["#006699", "#fcfbe3", "#191918"], //"warmbwblue",
		// ["#006699", "#006666", "#fcfbe3", "#191918"], //"warmbwbluegreen",
		//walking film
		["#262626", "#7B8DA6", "#4D688C", "#A4ADBF", "#D7D7D9", "#556C8B", "#828EA6", "#7A889D", "#B4B4BD", "#A8B0C1", "#405F83", "#BCC1D2", "#3E597E", "#080C11", "#1C1C1C", "#557299", "#D7D6DB", "#FDFCEB"], //blues
		//lake superior
		// ["#CCD8EA", "#CBD3DA", "#818794", "#5B5756", "#413A36", "#413B30"], //lake superior
		// ["#BEC4D0", "#C9CDD8", "#7E808C", "#282730", "#54545F", "#A5ACBF", "#AAA9A5", "#FBFBFF", "#535763", "#211F2B"], //canada snow
		// ["#C7CED8", "#C2C5CC", "#9C9A9D", "#454140", "#454140", "#383330", "#473D3B", "#767B7F"], //lake superior
		// ["#4E505D", "#4F525A", "#808394", "#A4AAB8", "#DEE5F7", "#E6EFFD"], //ice snow river
		// ["#8F97A2", "#5A575E", "#666A79", "#474C58", "#8790A0", "#B5C2D2", "#4E5043", "#181919"], //winter blue green tree
		// ["#BCBFC4", "#B9BABE", "#9FA0A5", "#98999E", "#72757A", "#63686E", "#555F64", "#505C60"], //subtle lake surface grays
		// ["#093F68", "#005A98", "#000112", "#E8ECF5", "#A8B5C8", "#538096", "#45758A", "#234E64", "#001929", "#0A4761", "#00132A", "#095A74", "#033A56", "#0C6180"], //lake superior (very blue)
		// ["#F2F4F8", "#90A2B1", "#475360", "#4E3728", "#B95F2E", "#4C5B70", "#678296", "#293E45"], //lake superior
		// ["#F6E8DD", "#BC8860", "#3B3735", "#405D68", "#041D24", "#606F6D", "#26383F", "#2F4D58", "#2F4652", "#657678", "#5A5858", "#19323D", "#837C75", "#854529"], //lake superior (blue with orange)
		// ["#839FB6", "#AEB7BF", "#A3A6A9", "#797B7B", "#3D4048", "#393A3B", "#688896", "#7C8FAA", "#3F5468"], //lake superior
		// ["#F8FCFD", "#A2B2CC", "#7A8193", "#6D6B51", "#5A583A", "#2C2D24", "#7D92AE", "#615F62", "#5C6C6C"], //lake superior
		// ["#485654", "#3D4949", "#7B8F9D", "#8695A3", "#8C99A1", "#82959C", "#839298", "#768387", "#738187", "#637074", "#738891", "#566871", "#BCCCD0", "#8698AA", "#515E65", "#35404E", "#566367"], //lake superior
		// //water
		// ["#C5E0FB", "#F3FBFD", "#52615E", "#18191B", "#90969A", "#27292E", "#A7C2E0", "#6B838D", "#7E9889", "#1B1E3E", "#110F24"], //waterfall
		// ["#7086A6", "#6E7C78", "#7895BF", "#424639", "#4A6B99", "#7389A3", "#4B607F", "#4F688A", "#263040", "#283247", "#3D536F", "#222126", "#948F84"], //lake (blue)
		// ["#969599", "#796C6C", "#675855", "#635049", "#79685C", "#6E5340", "#515054", "#6A5848", "#968F8A", "#4B4A4F", "#595453"], //lake bottom browns
		// ["#757260", "#616664", "#626562", "#E0E9F5", "#BFCEDF", "#A7ADB6", "#636A6C", "#5D5543", "#49402C", "#849BB4", "#5B422D", "#393E41", "#424544"], //pond
		// ["#BFB9A8", "#C3B481", "#6D604B", "#8E7A6E", "#8097AE", "#3B2F30", "#7F97AE"], //lake sand
		// ["#C3D3E1", "#A5B3BF", "#E5D1B7", "#E7D093", "#8C6F54", "#8CA0B1"], //lake sand
		// ["#696566", "#706E6F", "#79796E", "#AFB199", "#898A7C", "#676357", "#C8CAC9", "#41382C"], //moss
		// ["#E8DFD7", "#DDD6D0", "#8C8780", "#51504A", "#A9A69F", "#D2CCC4", "#444440", "#66685F", "#393B34", "#20211A", "#67665F"], //woods winter snow

		// ["#AAAAAC", "#7C7C7C", "#747371", "#525251", "#797372", "#343632", "#0C0E0B", "#42433E", "#434544", "#6C6D68"], //winter
		// ["#494B4A", "#494B4A", "#534B41", "#373934", "#8C887F", "#504531", "#201F19", "#5F5E5D", "#604F3D", "#5A5A57", "#30322C", "#211D15", "#696964", "#1F231B", "#393B36", "#554A47"], //winter
		// ["#525762", "#4A525F", "#5D6471", "#929DAE", "#AAB5CC", "#A5B0C3", "#353943", "#545F72"], //slate winter sky
		// ["#A8B0C3", "#9599A7", "#242222", "#292724", "#49484B", "#ADAEB3", "#2B2328", "#3F3F4F"], //canada winter
		// ["#414141", "#2B2B2A", "#615146", "#634D3B", "#947049", "#525B68", "#EDE8DB", "#2B261B", "#515262"], //outdoors fall
		// ["#C3C6CF", "#5775B0", "#837C7D", "#7A535B", "#593B3B", "#413B3F"], //boots jeans rock (nice blues browns)
		// ["#0D0F0E", "#767577", "#9AA6B4", "#A2AFB6", "#656863", "#3C3E3C", "#5F5B50", "#38301B", "#636E76", "#82949F", "#4C5A5C", "#302D26", "#A39E8E"], //outdoors fall (nice blues browns)
		
		// //greens
		// ["#183C76", "#64665C", "#967B21", "#5084CB", "#34361D", "#503E2B", "#38370E"], //bright day blue sky yellow leaves
		// ["#556D7F", "#444E33", "#4B5A37", "#50663E", "#6C7937", "#59613E", "#2A2D1E", "#545B38", "#788049", "#998800", "#324528", "#161B13", "#1B2519", "#343222"], //orchard
		// ["#7F7655", "#7C7C58", "#4C4F3A", "#ADA590", "#969374", "#7B7458", "#7D815D", "#454425", "#948C7F", "#5F6E4C", "#474633", "#BEB7A5"], //grasses (green yellow)
		// ["#6C6B6D", "#4B4B4D", "#373435", "#494C57", "#2E2B2E", "#242225", "#5F6264"], //rocks
		// ["#D1E3EF", "#9DAB92", "#8F9675", "#7A7E64", "#727A53", "#535E39", "#576245", "#566163", "#686E60"], //tree
		// ["#D7D6D8", "#8A8B84", "#5C6161", "#6B563F", "#272413", "#423930", "#1E260D", "#3D3A30", "#6D2E29", "#18190C", "#928C87"], //finland arteles
		// // ["#778BA8", "#5E6D86", "#686C76", "#4F463D", "#5A432F", "#44301D", "#37261A", "#3F231C", "#4D739F", "#5D1215", "#352B28", "#4A2A28"], //outdoors sumac
		// ["#675944", "#2E2E27", "#927F56", "#A18462", "#4B4437", "#544A39", "#2C352D", "#BEA886"], //grass shadow
		// ["#7A6C57", "#46382F", "#745F4F", "#928B88", "#977E6C", "#E2E3E7", "#3C3023", "#41491D", "#2C2521"], //muddy creek (greens browns)
		// // ["#A3958A", "#A49389", "#82706C", "#7C6D66", "#786662", "#746663"], //gravelroadcanada (all beige)
		// ["#17180E", "#585743", "#A9A497", "#938A5E", "#676320", "#463922", "#A76F09", "#A76406", "#3E441F", "#47502D", "#6F7948", "#A1A294", "#272C12"], //lake summer woods (green orange)
		// ["#45424A", "#393536", "#726558", "#B3A6A0", "#6C6060", "#818175", "#8C8E76", "#565C57"], //river rock (greens)
		// ["#B5C1CF", "#79838F", "#988D82", "#5B5351", "#665B49", "#5A5A4C", "#575D4E", "#4B594A", "#8291A4"], //finland fields () 
		// ["#484A2B", "#423F33", "#594E43", "#91827C", "#C9C7C6", "#44502A", "#5D6445"], //finnish forest (green brown)
		// ["#45403C", "#4A3325", "#463A32", "#A99374", "#A4845C", "#BBA156", "#4F4026", "#3F3B21"], //finland fields (green brown yellow)
		
		//loom
		// ["#EAF1F2", "#AFB4BB", "#A3998A", "#735F48", "#5B4F45", "#66513A", "#3D2A1D", "#050A0D", "#53463A"], //looom
		// ["#181410", "#3B302E", "#63544B", "#80756C", "#BFB3A5", "#978777", "#28221D", "#131111", "#E7D7BB", "#3D3730", "#F7EBD5"], //weaving
		// ["#C4BBAC", "#492E21", "#514A47", "#3C3833", "#46443E", "#73695E", "#897768", "#8A7766", "#0F0F0F", "#F5E7CD", "#393633", "#2F2F2C"], //weaving
		

		//ny
		// ["#FFFFFF", "##313331", "#524E4A", "#391F18", "#813B2B", "#A15444", "#354141", "#222222"], //nystairs
		// ["#332725", "#535051", "#705E5A", "#80807F", "#7A756B", "#80807F", "#E8EDF2", "#785E56", "#47484A"], //nystairs
		// ["#42433E", "#5C5C58", "#81796C", "#484238", "#5C5042", "#000000", "#1F2C40", "#2B3E57", "#2A3540", "#78766D"], //nystairs
		// ["#5E646F", "#9BB4C6", "#7F7976", "#4E596E", "#3E3839", "#70625A"], //nystairs (some blue)
		// ["#786652", "#5B4031", "#1A1E1C", "#B6B7B5", "#9B999C", "#16190D", "#5F3D35", "#71391E"], //nystairs
		// ["#FBFBFD", "#7B7879", "#575758", "#5D5048", "#7F7066", "#3C3C3C"], //nystairs
		// ["#977A6D", "#5B5350", "#87847D", "#57646F", "#AFBBC2", "#B6ADA8", "#1B3B51", "#2D2E31", "#546877"], //nystairs (blues)
		// ["#873E04", "#463730", "#7D838A", "#CE8430", "#732F02", "#4E4340", "#453732", "#A19F9B", "#5B4F44"], //nylibrary browns grays
		// ["#403B37", "#444242", "#444242", "#2F2824", "#423D3B", "#423D3B", "#8B5D3E", "#3F3E3F", "#2A211A", "#D8D8D8", "#6C727D"], //nylibrary browns grays blues
		// ["#644C39", "#5B4536", "#B69D88", "#614C3E", "#16100C", "#150F0B", "#120D07"], //ny art haring? all browns dark
		// ["#662512", "#865E40", "#B9916F", "#B58562", "#965C3D", "#662512", "#53200A", "#432916", "#955C3D", "#4A3321"], //ny art reds browns clay
		// ["#040302", "#75604F", "#CDBBAB", "#77614A", "#0E0A06", "#BEA794", "#603102", "#93520D", "#A99588", "#A97D51"], //ny art reds browns clay
		// ["#C09A7A", "#C68425", "#9C1704", "#B38968", "#0D0604", "#967051", "#941102", "#A64A25"], //nyart yellow orange red (vivid color)
		// ["#A4886E", "#866648", "#5F3B1A", "#452B14", "#79552C", "#896338", "#0D0903", "#AA9179", "#4F3015"], //nyart browns
		// ["#AE7C41", "#A54B18", "#AC6C35", "#90350F", "#75270D", "#633E1A", "#0A0502", "#A3270C"], //nyart browns red harring
		// ["#C39B72", "#C29464", "#9A622C", "#864B12", "#823607", "#69350D", "#86480F", "#583D26", "#51270E"], //nyart browns  hesse
		// ["#676863", "#3E3E3C", "#82796D", "#444037", "#5F5343", "#000000", "#3B5478", "#233047", "#333630", "#413A33", "#343C35", "#20293C", "#4E483E"], //ny street sky blue gray brown
		// ["#B1B4B0", "#7D7672", "#604A49", "#504343", "#583E3F", "#828F87", "#61605B"], //nystreet (bg brown)
		// ["#392F28", "#34342E", "#696966", "#5F5B56", "#CDCDCD", "#FFFFFF", "#503D34", "#262420"], //nystreet grays bg brown
		// ["#2C2F2E", "#505351", "#271814", "#823A2B", "#A15444", "#777673", "#453D34"], //ny stairs grays reds bg orange
		//city
		// ["#46474A", "#6C665F", "#6C6C6C", "#2C2D25", "#8D9194", "#2C2920", "#57524E", "#5C5D58"], //window mpls warehouse (green gray brown beige)
		// ["#848482", "#BEAA81", "#88816F", "#9D9892", "#463D2C", "#7F745E", "#30251A", "#3F3626", "#A09C93"], //mpls warehouse window (some yellow)
		// ["#AFBDD0", "#D7DCE1", "#93A7B8", "#4D585B", "#585151", "#908985", "#848181", "#4D585"], //tiger dancing (blues gray)
		// ["#D0D0D0", "#FBFBFB", "#999B99", "#91867F", "#5B4939", "#47392B", "#3C5D5C", "#535351", "#586463", "#304142", "#33261D", "#745C4B"], //bridge bgs (bg brown white0)
		// ["#4B2D13", "#081B30", "#194874", "#0B1C2C", "#0B1C2C", "#101721", "#305F83"], //canada night image w/brown blue dark too vivid?
		// ["#172F4F", "#2A68A1", "#2B4E6B", "#103354", "#3C6FA4"], //canada night image ll blue dark combine with above?
		// ["#EFF0F2", "#DAD1C5", "#828075", "#353934", "#0F1214", "#091007", "#47493D", "#393E2F", "#484E42", "#2D372E"], //greens mist railway duluth with white
		//iowa
		// ["#CAC4BE", "#A49C99", "#716863", "#675F5A", "#8C857F", "#6D6560", "#635A55", "#948D87", "#655D58", "#C7C1BA"], //iowa farm gradient (all beige)
		// ["#5B534E", "#685E59", "#9E948E", "#C3BBB5", "#999089", "#978D87"], //iowa farm gradient (all beige)
		// ["#2A3135", "#596D86", "#8598B1", "#B8BFD3", "#6C7C8C", "#566D8B"], //iowa farm gradient (all blues)
		// ["#893D22", "#A9400A", "#BBB594", "#732D14", "#ACB9A2", "#5A1B00", "#87886B"], //iowa brick bldg
		// ["#E5E2E6", "#CAC7C9", "#786458", "#5B4D41", "#644629", "#5F5E50", "#943800", "#2F1E0C", "#47453E", "#372A1E"], //iowa brick bldg
		// ["#9B3C16", "#922400", "#A07E66", "#BAB8B5", "#E5E6E1", "#A16F58", "#421A03", "#381A04", "#481D09", "#939284"], //iowa brick bldg
		// ["#D3D3D5", "#B2B3B6", "#1F1F20", "#444C35", "#6F6C5C", "#7F745C", "#3C3F31", "#726A52", "#817153"], //iowa stone bldg
		// ["#6A4E45", "#8F7257", "#836D60", "#979EA2", "#54615E", "#45493C"], //iowa stone bldg
		// ["#787574", "#C3C3C4", "#616263", "#595139", "#3A3E27", "#ABABA9", "#363D23", "#746E64"], //iowa stone bldg
		// ["#6B85B5", "#614E28", "#8B8A87", "#726853", "#FFFDFB", "#453925", "#483D22", "#36363E", "#A7A6A3", "#C2B5A3"], //iowa bldg
		// ["#FEFAF1", "#E7DBCE", "#BDB6B0", "#94897E", "#7A7E85", "#625D4C", "#5F3B2B", "#898785", "#220300", "#76766C"], //iowa silo
		// ["#FFF8EE", "#978A80", "#09090A", "#EFE8E0", "#888D8E", "#6F6F62", "#2E0200", "#7C746D", "#CABCA8"], //iowa silo
		// ["#5A513E", "#A09C93", "#AA5818", "#905C29", "#AD5E1D", "#6B4219", "#6B4219", "#C87A48", "#562400", "#886236", "#989167"], //iowa bldg
		// ["#7E878D", "#322923", "#748288", "#D8E0DE", "#7E3E36", "#623124", "#7F2E29", "#C3CECE", "#2E3B49", "#11141D"], //iowa bldg marion
		// ["#F6F8FD", "#C2CACF", "#8C8C8A", "#835D51", "#64473D", "#6C7069", "#5C5B55", "#939B99", "#908675", "#4C443E"], //iowa bldgs
		// ["#BFB7A5", "#A4988B", "#6A7A88", "#070000", "#2F241C", "#592916", "#77504D", "#52525D", "#8F5F59"], //iowa bldg
		// ["#78747E", "#B3A895", "#6D6D60", "#605038", "#D7D3CE", "#AAA8AF", "#4D4739", "#241809", "#442500", "#40392A", "#494234", "#69695D"], //iowa cedar rapids under bridge 1
		// ["#A3A8AC", "#FAF1E5", "#969494", "#706B62", "#69788A", "#3C587C", "#171717", "#273F5A", "#48413A"], //iowa cedar rapids under bridge
		//cello
		// ["#1A0A03", "#2D0E08", "#6B2E12", "#613716", "#9E6528", "#5F370C", "#9A1905", "#FFF9C9"], //cello at sacred heart
		// ["#0E0600", "#2E0F04", "#0F0700", "#484E42", "#577871", "#010101", "#FFFFFF", "#406861", "#902200"], //cello at sacred heart
		// ["#78685B", "#B4A19A", "#877C6A", "#2F3C35", "#435046", "#242216", "#6B867D", "#993B21", "#000100", "#725128", "#15211D"], //cello at sacred heart
		// ["#6B6259", "#43403B", "#51524D", "#8A300F", "#743B1D", "#988071", "#2D2F2E", "#B9AA8D", "#64655E"], //cello stairwell*
		// ["#3D1C04", "#0D0604", "#411B0D", "#6D3F26", "#8E7061", "#8E9490"], //cellosacredheart
		//birdland
		["#163341", "#172F47", "#4477A8", "#2A4A69", "#52779B", "#000000", "#384B60", "#1F3350", "#153A69", "#153559", "#9D9990", "#9D9990", "#181E21", "#0C1D32", "#706959", "#D6D3CE", "#534E48", "#3E5766", "#222E34", "#BBB4A4", "#7C7D7F"], //birdland

	];
	z.streams["color"] = ( dt => {
		let date0 = new Date();
		let t0 = Math.floor(date0.getTime()/1000);
		let state0 = { 
			dt: dt, count: 0,
			choices: playlist[ Math.floor(t0/dt)%playlist.length ]
		};
		return z.streams["clock"].filter( e => e.t%dt===0 )
			.scan( (state, e) => { 
				state.choices = playlist[ Math.floor(e.t/dt)%playlist.length ];
				// state.choices = playlist[ Math.floor(state.count)%playlist.length ];
				state.count = state.count + 1;
				return state;
			}, state0  )
	})( 38 );
	
	z.streams["draw"] = Kefir.combine([z.streams["clock"]], [z.streams["dimensions"], z.streams["color"]], (clock, dimensions, color) => { return {clock:clock, dimensions:dimensions, color:color} })
		.scan( (state, e) => { 
			state.clock = e.clock;
			state.dimensions = e.dimensions;
			state.color = e.color;
			state.count = state.count + 1;
			z.tools.logmsg("color.choices = " + e.color.choices);
			return state;
	}, {clock:{t:0}, dt:1}  );

//box
// ( dt => {
// 	const element = document.createElementNS("http://www.w3.org/2000/svg", "rect");
// 	element.setAttributeNS(null, "id", "box");
// 	element.setAttributeNS(null, "class", "shape square");
// 	z.elements["svg"].el.appendChild(element);
		
// 	z.streams["draw"].filter(e => e.clock.t%dt===0).onValue( e => {
// 		try {
// 			let color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
// 			Velocity({	
// 				elements: element, 
// 				properties: { fillOpacity: 1.0, strokeOpacity: 0.0, fill: color, width: e.dimensions.width, height: e.dimensions.height },
// 				options: { duration: 2000,  delay: 0, easing: "easeInOutQuad" },
// 			});
// 		} catch(err) { z.tools.logerror("box animation ::: " + err ) }
// 	})
// })(5);

//main
( dt => {
	const element = document.querySelector("main");
	const bgcolors = ["rgba(25, 25, 24, 0.4)", "rgba(25, 25, 24, 0.6)", "rgba(25, 25, 24, 0.9)", "rgba(252, 251, 227, 0.4)", "rgba(252, 251, 227, 0.9)", , "rgba(252, 251, 227, 0.6)"]
	// const warmblacktints = ["#191918", "#2f2f2f", "#464646", "#5e5e5d", "#757574", "#8c8c8b", "#a3a3a2", "#babab9", "#d1d1d0", "#e8e8e7", "#ffffff", "#fcfbe3", "#e2e1cc", "#c9c8b5", "#b0af9e", "#979688", "#7e7d71", "#64645a", "#4b4b44", "#32322d", "#191916", "#000000"];
	const warmblacktints = ["#191918", "#fcfbe3", "#000000"];
	const blues = ["#262626", "#7B8DA6", "#4D688C", "#556C8B", "#828EA6", "#7A889D",  "#405F83", "#3E597E", "#080C11", "#1C1C1C", "#557299"];
	z.streams["draw"].filter(e => e.clock.t%dt===0).onValue( e => {
		try {
			let count = e.clock.t/dt;
			// let color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
			// z.tools.logmsg("in BOX " + color + " color =  " + color);
			let color = blues[z.tools.randominteger(0, blues.length)];
			Velocity({	
				elements: element, 
				properties: { backgroundColor:  color, backgroundColorAlpha: z.tools.randominteger(2,8)/10},
				options: { duration: 1200,  delay: 0, easing: "easeInOutQuad" },
			});
		} catch(err) { z.tools.logerror("box animation ::: " + err ) }
	})
})(9);


//lines
( dt => {
	let nshapes = [2,4][v];
	let width = window.innerWidth, height = window.innerHeight;
	const elements = [...Array(nshapes).keys()].reduce( (acc, j) => {
		// z.tools.logmsg("create line element ::: " + id);
		let el = document.createElementNS("http://www.w3.org/2000/svg", "line");
		el.setAttributeNS(null, "id", "line_"+ j);
		el.setAttributeNS(null, "class", "shape line");
		el.setAttributeNS(null, "stroke-width", width);
		el.setAttributeNS(null, "stroke-opacity", 0.01);
		// el.setAttributeNS(null, "stroke-dasharray", z.tools.randominteger(height/2,height));
		el.setAttributeNS(null, "x1", width/2);
		el.setAttributeNS(null, "x2", width/2);
		el.setAttributeNS(null, "y1", 0);
		el.setAttributeNS(null, "y2", height);

		z.elements["svg"].el.appendChild(el);
		acc[j] = { el: el };
	return acc;
	}, []);

	const drawings = [
		e => {
			try {
				let count = e.clock.t/dt;
				let width = e.dimensions.width, height = e.dimensions.height;
				let color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
				Velocity({	
					elements: elements[count%nshapes].el,
					properties: { strokeOpacity: z.tools.randominteger(1,8)/10, stroke: color, strokeWidth: z.tools.randominteger(0,e.dimensions.height*2), strokeDasharray: z.tools.randominteger(18, e.dimensions.min/2), x1: 0, x2: e.dimensions.width, y1: e.dimensions.height, y2: e.dimensions.height },
					options: { duration: z.tools.randominteger(1000*dt*nshapes/3,1000*dt*nshapes), delay: 0 },
				});
			} catch(err) { z.tools.logerror("circle animation 1 ::: " + err ) }
		},
		
	];
	z.streams["draw"].filter(e => e.clock.t%dt===0).onValue( e => {
		drawings[0](e);
	})
})(1);

//circles0
( dt => {
	let nshapes = [2,4][v];
	let width = window.innerWidth, height = window.innerHeight;
	let colors = ["#163341", "#172F47", "#4477A8", "#2A4A69", "#52779B", "#000000", "#384B60", "#1F3350", "#153A69", "#153559", "#9D9990", "#9D9990", "#181E21", "#0C1D32", "#706959", "#D6D3CE", "#534E48", "#3E5766", "#222E34", "#BBB4A4", "#7C7D7F"]; //birdland
	const elements = [...Array(nshapes).keys()].reduce( (acc, j) => {
		let el = document.createElementNS("http://www.w3.org/2000/svg", "circle");
		el.setAttributeNS(null, "id", "circle0_"+ j);
		el.setAttributeNS(null, "class", "shape circle");
		el.setAttributeNS(null, "cy", 0);
		el.setAttributeNS(null, "cx", width/2);
		z.elements["svg"].el.appendChild(el);
		acc[j] = { el: el };
	return acc;
	}, []);

	const drawings = [
		e => {
			try {
				let count = e.clock.t/dt;
				let r = z.tools.randominteger(e.dimensions.min/10, e.dimensions.min);
				let color = colors[z.tools.randominteger(0, colors.length)];
				Velocity({	
					elements: elements[count%nshapes].el,
					properties: { fillOpacity: z.tools.randominteger(1,8)/10, strokeOpacity: 0.0, fill: color, stroke: color, strokeWidth: z.tools.randominteger(1,8)/10*r, strokeDasharray: z.tools.randominteger(8, r), cx: e.dimensions.width/2, cy: 0, r: r },
					options: { duration: z.tools.randominteger(1000*dt*nshapes/3,1000*dt*nshapes), delay: 0 },
				});
			} catch(err) { z.tools.logerror("circle animation 1 ::: " + err ) }
		},
		
	];
	z.streams["draw"].filter(e => e.clock.t%dt===0).onValue( e => {
		drawings[0](e);
	})
})(2);

//circles1
// ( dt => {
// 	let nshapes = [4,8][v];
// 	let width = window.innerWidth, height = window.innerHeight;
// 	let colors = ["#163341", "#172F47", "#4477A8", "#2A4A69", "#52779B", "#000000", "#384B60", "#1F3350", "#153A69", "#153559", "#9D9990", "#9D9990", "#181E21", "#0C1D32", "#706959", "#D6D3CE", "#534E48", "#3E5766", "#222E34", "#BBB4A4", "#7C7D7F"]; //birdland
// 	const elements = [...Array(nshapes).keys()].reduce( (acc, j) => {
// 		let el = document.createElementNS("http://www.w3.org/2000/svg", "circle");
// 		el.setAttributeNS(null, "id", "circle1_"+ j);
// 		el.setAttributeNS(null, "class", "shape circle");
// 		el.setAttributeNS(null, "cy", height/2);
// 		el.setAttributeNS(null, "cx", width/2);
// 		z.elements["svg"].el.appendChild(el);
// 		acc[j] = { el: el };
// 	return acc;
// 	}, []);

// 	const drawings = [
// 		e => {
// 			try {
// 				let count = e.clock.t/dt;
// 				let r = z.tools.randominteger(e.dimensions.min/6, e.dimensions.min);
// 				let color = colors[z.tools.randominteger(0, colors.length)];
// 				Velocity({	
// 					elements: elements[count%nshapes].el,
// 					properties: { fillOpacity: count%2===0 ? 1.0 : 1.0, strokeOpacity: count%2===1 ? 0.0: 0.0, fill: color, stroke: color, strokeWidth: r/4, strokeDasharray: z.tools.randominteger(8, r), cx: e.dimensions.width/2, cy: e.dimensions.height/2, r: r },
// 					options: { duration: z.tools.randominteger(1000*dt*nshapes/3,1000*dt*nshapes), delay: 0 },
// 				});
// 			} catch(err) { z.tools.logerror("circle animation 1 ::: " + err ) }
// 		},
		
// 	];
// 	z.streams["draw"].filter(e => e.clock.t%dt===0).onValue( e => {
// 		drawings[0](e);
// 	})
// })(2);


//circles 2
// ( dt => {
// 	const nelements=[[...Array(4).keys()],[...Array(8).keys()]][v];
// 	let width = window.innerWidth, height = window.innerHeight;
// 	const elements = nelements.reduce( (acc, id) => {
// 		z.tools.logmsg("create line element ::: " + id);
// 		let el = document.createElementNS("http://www.w3.org/2000/svg", "circle");
// 		el.setAttributeNS(null, "id", "circle2_"+ id);
// 		el.setAttributeNS(null, "class", "shape circle");
// 		el.setAttributeNS(null, "stroke-opacity", "0.0");
// 		el.setAttributeNS(null, "fill-opacity", "0.1");
// 		el.setAttributeNS(null, "cy", height/2);
// 		el.setAttributeNS(null, "cx", width/2);
// 		// el.setAttributeNS(null, "r", height/6);
// 		z.elements["svg"].el.appendChild(el);
// 		acc[id] = { el: el };
// 	return acc;
// 	}, []);
// 	// const cxs = [0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9];
// 	const cxs = [0.2,0.5,0.8];
// 	const cys = [0.2,0.5,0.8];
// 	const n = elements.length;
// 	const drawings = [
// 		e => {
// 			try {
// 				let count = e.clock.t/dt;
// 				let timing = timings[z.tools.randominteger(0,timings.length)];
// 				let duration = dt*timing[0], delay = z.tools.randominteger(0, dt*timing[1]);
// 				let element = elements[count%n];
// 				let cy = e.dimensions.height*cys[count%cys.length];
// 				// let cx = e.dimensions.width*cxs[z.tools.randominteger(0,cxs.length)];
// 				let cx = e.dimensions.width*cxs[(count%n)%cxs.length];
// 				let radius = z.tools.randominteger(14, e.dimensions.min/2);
// 				let color = e.color.choices[z.tools.randominteger(0, e.color.choices.length)];
// 				Velocity({	
// 					elements: element.el,
// 					properties: { fillOpacity: 1.0, strokeOpacity: 0.0, stroke: color, strokeWidth: z.tools.randominteger(radius/2, radius/4), strokeDasharray: z.tools.randominteger(8, radius), fill: color, cx: cx, cy: cy, r: radius },
// 					options: { duration: duration*n/2,  delay: delay },
// 				});
// 				Velocity({	
// 					elements: element.el,
// 					properties: { fillOpacity: 0.0, r: radius/4 },
// 					options: { duration: duration*n/2,  delay: delay*n },
// 				});
// 			} catch(err) { z.tools.logerror("circle animation 1 ::: " + err ) }
// 		},
		
// 	];
// 	z.streams["draw"].filter(e => e.clock.t%dt===0).onValue( e => {
// 		drawings[Math.floor(e.clock.t/(dt*elements.length))%drawings.length](e);
// 	})
// })(1);






};
z.radio = ( () => { 
	const soundcorepath = "data/sound/";
	const instruments = {
		// bagpipe1a: {clip: "bagpipe1a", minvolume: 0.3, maxvolume: 0.9, playbackRate: () => { return z.tools.randomlowharmonic()/10 } },
		// bagpipe1ahigh: {clip: "bagpipe1a", minvolume: 0.3, maxvolume: 0.9, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		bagpipe1e: {clip: "bagpipe1e", minvolume: 0.3, maxvolume: 0.9, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		bagpipe1f: {clip: "bagpipe1f", minvolume: 0.3, maxvolume: 0.9, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		bagpipe1g: {clip: "bagpipe1g", minvolume: 0.3, maxvolume: 0.9, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		bagpipe1h: {clip: "bagpipe1h", minvolume: 0.3, maxvolume: 0.9, playbackRate: () => { return z.tools.randomlowharmonic()/10 } },
		bagpipe1: {clip: "bagpipe1", minvolume: 0.3, maxvolume: 0.9, playbackRate: () => { return z.tools.randomlowharmonic()/4 } },
		bagpipe1high: {clip: "bagpipe1", minvolume: 0.3, maxvolume: 0.9, playbackRate: () => { return z.tools.randomharmonic()/4 } },
		thunk: {clip: "thunk", minvolume: 0.3, maxvolume: 0.8, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		thunkhighharmonic: {clip: "thunk", minvolume: 0.3, maxvolume: 0.8, playbackRate: () => { return z.tools.randomhighharmonic()/10 } },
		birds5harmonic: {clip: "birds5",minvolume: 0.2, maxvolume: 0.5, playbackRate: () => { return z.tools.randomhighharmonic()/10 } },
		knocking1: {clip: "knocking1", minvolume: 0.4, maxvolume: 0.9, playbackRate: () => { return z.tools.randominteger(4,48)/10 } },
		cmpb20200708_5harmonic: {clip: "cmpb20200708_5", minvolume: 0.4, maxvolume: 0.9, playbackRate: () => { return z.tools.randomhighharmonic()/10 } },//* voice
		// cello_pitch1: {clip: "cello_pitch1", minvolume: 0.3, maxvolume: 0.8, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		// cello_pitch1harmonic: {clip: "cello_pitch1", minvolume: 0.3, maxvolume: 0.8, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		// bird1harmonic: {clip: "bird1", minvolume: 0.8, maxvolume: 1.0, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		// birdcanyon: {clip: "birdcanyon", minvolume: 0.8, maxvolume: 1.0, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		// bagpipegeese: {clip: "bagpipegeese", minvolume: 0.8, maxvolume: 1.0, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		celloknockcanyon: {clip: "celloknockcanyon", minvolume: 0.8, maxvolume: 1.0, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		// voxmct0: {clip: "voxmct0", minvolume: 0.8, maxvolume: 1.0, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		// stapler: {clip: "stapler", minvolume: 0.8, maxvolume: 1.0, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		train1: {clip: "train1", minvolume: 0.4, maxvolume: 0.8, playbackRate: () => { return z.tools.randominteger(6,18)/10 } },
		weatherradio1: {clip: "weatherradio1", minvolume: 0.6, maxvolume: 1.0,  playbackRate: () => { return z.tools.randominteger(6,12)/10 } },
		// longbell: {clip: "longbell", minvolume: 0.4, maxvolume: 0.8, playbackRate: () => { return z.tools.randominteger(9,18)/10 } },
		// cellothunktelephone: {clip: "cellothunktelephone", minvolume: 0.8, maxvolume: 1.0, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		// cellothunkradio: {clip: "cellothunkradio", minvolume: 0.8, maxvolume: 1.0, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		// t0: {clip: "t0", minvolume: 0.8, maxvolume: 1.0, playbackRate: () => { return z.tools.randomharmonic()/10 } },
		tornadosirenharmonic: {clip: "tornadosiren", minvolume: 0.1, maxvolume: 0.6, playbackRate: () => { return z.tools.randomlowharmonic()/10 } },									
	};
	let clips = {};
	Object.entries(instruments).forEach( instrument => {
		clips[instrument[1].clip] = { url: soundcorepath + instrument[1].clip + ".mp3", loaded:false, duration:0, buffer:{} };
	});
	let radio = {
		player: {}, loading: [], loaded: false,
		soundplaying:false,
		instruments: instruments, clips: clips,
		clipduration: { min:0, max:0 },
		nbuffersplaying: 0, maxbuffersplaying: [14,18][v],
		intervals: {
			lowi: function(basetone){ return Math.floor(basetone/4) },
			i: function(basetone){ return Math.floor(basetone/2) },
			I: function(basetone){ return Math.floor(basetone/1) },
			II: function(basetone){ return Math.floor(basetone*9/8) },
			III: function(basetone){ return Math.floor(basetone*5/4) },
			iii: function(basetone){ return Math.floor(basetone*6/5) },
			IV: function(basetone){ return Math.floor(basetone*4/3) },
			V: function(basetone){ return Math.floor(basetone*3/2) },
			VI: function(basetone){ return Math.floor(basetone*5/3) },
			VII: function(basetone){ return Math.floor(basetone*15/8) },
			vii: function(basetone){ return Math.floor(basetone*9/5) },
			VIII: function(basetone){ return Math.floor(basetone*2) },
		},
		loadclips: z => {
			Object.keys(z.radio.clips).forEach( key => {
				let clip = z.radio.clips[key];
				if(!z.radio.loading.includes(clip.url)) {
					z.radio.loading.push(clip.url);
					let request = new XMLHttpRequest();
					//for localhost testing
					// request.open("GET", window.location.protocol + "//" + window.location.hostname + ":" + window.location.port + "/web/" + clip.url, true);
					// z.tools.logmsg("url = " + window.location.protocol + "//" + window.location.hostname + ":" + window.location.port + "/web/" + clip.url);
					// for deploy
					request.open("GET", window.location.protocol + "//" + window.location.hostname + "/" + clip.url, true);
					// z.tools.logmsg("url = " + window.location.protocol + "//" + window.location.hostname + "/"  + clip.url);
					request.responseType = "arraybuffer";
					request.onload = () =>  {
						z.tools.logmsg("loaded" + clip.url);
						z.radio.player.context.decodeAudioData(request.response, buffer => {
							clip.loaded = true;
							clip.buffer = buffer;
							clip.duration = clip.buffer.duration;
							if( clip.duration > z.radio.clipduration.max) {z.radio.clipduration.max = clip.duration}
							else if( clip.duration < z.radio.clipduration.min) {z.radio.clipduration.min  = clip.duration}
							z.tools.logmsg("decoded" + clip.url);
						}, e => {
							z.tools.logerror("audio error! clip = " + clip.url + ", err = " + e);
						});
						
					};
					request.send();
				}
			});
			z.radio.loaded = true;
		},
		start: z => {
			/* set up player*/
			window.AudioContext = window.AudioContext || window.webkitAudioContext;
			z.radio.player.context = new AudioContext();
			/* experimental parameters */
			let parameters = [
				{ gain: 0.4, threshold: -24, knee: 30, ratio: 12, attack: 0.003, release: 0.25 }, //default
				{ gain: 0.3, threshold: -18, knee: 30, ratio: 18, attack: 0.0003, release: 0.28 },
				{ gain: 0.5, threshold: -8, knee: 30, ratio: 18, attack: 0.003, release: 0.28 },
				{ gain: 0.8, threshold: -8, knee: 30, ratio: 18, attack: 0.003, release: 0.28 },
				];
			let n = 0;

			//with compressor
			z.radio.player.compressor = z.radio.player.context.createDynamicsCompressor();
			z.radio.player.compressor.threshold.value = parameters[n].threshold;
			z.radio.player.compressor.knee.value = parameters[n].knee;
			z.radio.player.compressor.ratio.value = parameters[n].ratio;
			
			z.radio.player.compressor.attack.value = parameters[n].attack;
			z.radio.player.compressor.release.value = parameters[n].release;
			z.radio.player.gain = z.radio.player.context.createGain();
			z.radio.player.gain.value = parameters[n].gain;
			z.radio.player.compressor.connect(z.radio.player.gain);
			z.radio.player.gain.connect(z.radio.player.context.destination);
			// //with no compressor
			// z.radio.player.gain = z.radio.player.context.createGain();
			// z.radio.player.gain.value = parameters[n].gain;
			// z.radio.player.gain.connect(z.radio.player.context.destination);
		},
		playtone: ({ volume=0.8, delay=0, fadetime=0.1, duration=1.0, frequency=380 } = {}) => { 
			let vco = z.radio.player.context.createOscillator();
			vco.frequency.value = frequency;
			vco.type = "sine";
			let vca = z.radio.player.context.createGain();
			
			vco.connect(vca);
			vca.connect(z.radio.player.gain);
			let now = z.radio.player.context.currentTime;
			//fade in
			vca.gain.exponentialRampToValueAtTime(0.001, now + delay);
			vca.gain.exponentialRampToValueAtTime(volume, now + fadetime + delay);
			//fade out
			vca.gain.exponentialRampToValueAtTime(volume, now + duration + delay - fadetime);
			vca.gain.exponentialRampToValueAtTime(0.001, now + duration + delay);
			vco.start(now + delay);
			vco.stop(now + delay + duration + fadetime);
			vco.onended = function() {
			  	vco.disconnect(); vca.disconnect();
			}
		},
		playbuffer: ( { volume=0.8, delay=0, fadetime=1, duration=2, instrument=z.radio.instruments["bagpipe1f"] } = {} ) =>  {
			try {
				// let instrument = z.radio.instruments[zinstrument];
				let clip = z.radio.clips[instrument.clip];
				z.tools.logmsg("***buffer requested = " + instrument.clip + " z.radio.nbuffersplaying = " + z.radio.nbuffersplaying);
				if(clip.loaded && (z.radio.nbuffersplaying<z.radio.maxbuffersplaying-1 || z.radio.nbuffersplaying>z.radio.maxbuffersplaying+2)) {
					let rate = instrument.playbackRate ? instrument.playbackRate() : 1.0;
					try {
						// z.tools.logmsg("rate = " + rate + " ::: duration = " + clip.duration*rate);
						let vca = z.radio.player.context.createGain(); 
						let source = z.radio.player.context.createBufferSource();
						source.buffer = clip.buffer;
						source["playbackRate"].value = rate;
						source.connect(vca);
						vca.connect(z.radio.player.gain);
						source.loop = false;
						source.onended = e =>  { 
							z.radio.nbuffersplaying=z.radio.nbuffersplaying-1;
						};
						++z.radio.nbuffersplaying;
						let now = z.radio.player.context.currentTime;
						let dur = clip.duration < duration ? clip.duration/rate : rate*duration/rate;
						let dt = Math.min(fadetime, dur*.25);
						let offset = z.tools.randominteger(0, (dur-4*dt)*10)/10;
						// source.start(now, offset, dt*4); //parameters (when,offset,duration)
						vca.gain.setValueAtTime(0.001, now);
						vca.gain.exponentialRampToValueAtTime(volume, now + dt);
						vca.gain.setValueAtTime(volume, dur - 2*dt);
						vca.gain.exponentialRampToValueAtTime(0.001, now + dur-dt*0.5 );
						source.start(now, offset, dur); //parameters (when,offset,duration)
						// z.tools.logmsg("playing = " + clip.url);
					} catch(e) { z.tools.logerror("error applying params to audio buffer e::: " + e) }
				}
				else {	
					z.tools.logmsg("NOT playing = " + clip.url);
				}
			}
			catch(err) { z.tools.logerror("line playbuffer" + err) }
		},
		play: z => {
			const defaultduration = (dt,n,graintdt,clip) => dt/(graindt*2);
			const defaultfadetime = (dt,n,graintdt,clip) => dt/(graindt*20);
			const defaultpart = (dt=4000, n=4, graindt=400, chance=0.8, duration=defaultduration, fadetime=defaultfadetime, instruments=["celloknockcanyon"]) => { return {dt:dt, chance:chance, graindt: graindt, n: 5, duration: duration(dt,n,graintdt), fadetime: fadetime(dt,n,graintdt), instruments: ["celloknockcanyon"] } };
			const score = [
				// ((dt=4000, n=4, graindt=400, chance=0.8) => { return {dt:dt, chance:chance, graindt: graindt, n: 5, duration: dt/(graindt*2), fadetime: dt/(graindt*20), instruments: ["birdcanyon", "birds5harmonic", "voxmct0", "cmpb20200708_5harmonic", "longbell"] } })(14000,5,500),
				((dt=4000, n=4, graindt=400, chance=0.8) => { return {dt:dt, chance:chance, graindt: graindt, n: 5, duration: dt/(graindt*2), fadetime: dt/(graindt*20), instruments: ["train1", "tornadosirenharmonic","weatherradio1"] } })(4000,5,600),
				((dt=4000, n=4, graindt=400, chance=0.8) => { return {dt:dt, chance:chance, graindt: graindt, n: 5, duration: dt/(graindt*2), fadetime: dt/(graindt*20), instruments: ["celloknockcanyon", "cmpb20200708_5harmonic", "thunkhighharmonic"] } })(5000,3,500,0.6),
				// ((dt=4000, n=4, graindt=400, chance=0.8) => { return {dt:dt, chance:chance, graindt: graindt, n: 5, duration: dt/(graindt*2), fadetime: dt/(graindt*20), instruments: ["bagpipe1", "bagpipe1a", "tornadosirenharmonic", "tornadosirenharmonic"] } })(17000,6,400,0.8),
				((dt=4000, n=4, graindt=400, chance=0.8) => { return {dt:dt, chance:chance, graindt: graindt, n: 5, duration: dt/(graindt*2), fadetime: dt/(graindt*20), instruments: ["celloknockcanyon"] } })(5000,4,400,0.8),
				((dt=4000, n=4, graindt=400, chance=0.8) => { return {dt:dt, chance:chance, graindt: graindt, n: 5, duration: dt/(graindt*2), fadetime: dt/(graindt*20), instruments: ["bagpipe1e","bagpipe1f","bagpipe1g","bagpipe1h"] } })(3000,4,400,0.8),
				// ((dt=4000, n=4, graindt=400, chance=0.8) => { return {dt:dt, chance:chance, graindt: graindt, n: 5, duration: dt/(graindt*2), fadetime: dt/(graindt*20), instruments: ["cmpb20200708_5harmonic"] } })(9000,6,400,0.8),
			];
			score.forEach( (part,j) => {
				z.streams["clock"].filter( e => e.t%Math.floor(part.dt/1000)===0 && z.tools.randominteger(0,10)<part.chance*10 && z.radio.soundplaying)
					.onValue( e=> {
						let clip = part.instruments[z.tools.randominteger(0,part.instruments.length)];
						Kefir.sequentially(part.graindt, [...Array(part.n).keys()]).onValue( x => { 
							z.radio.playbuffer({duration:part.duration, fadetime:part.fadetime, instrument:z.radio.instruments[clip], volume: z.tools.randominteger(z.radio.instruments[clip].minvolume*10, z.radio.instruments[clip].maxvolume*10)/10});
						});
					})
			});
		}
	};
	
	let soundlink = document.querySelector("#soundlink");
	let telegraph = document.querySelector("#telegraph");
	let audio1 = document.querySelector("#audio1");
 	let video=document.querySelector("video");

	Kefir.fromEvents(soundlink, "click").onValue( e => {
		z.tools.logmsg("play sound !");
		// video.muted = !video.muted;
		if(!radio.soundplaying) { 
			try {
				audio1.currentTime = z.tools.randominteger(0,120);
				audio1.volume = 0.6;
				audio1.playbackRate = z.tools.randominteger(4,40)/10;
				audio1.play();


				radio.player.context.resume().then(() => {
					z.tools.logmsg("playback resumed");
					radio.soundplaying = true;
					soundlink.innerText = "turn off sound";
				});
			} catch(e) { z.tools.logerror("dashboard ::: resumeaudio " + e) } 
		}
		else { 
			try {
				audio1.pause();
				radio.player.context.suspend().then(() => {
					radio.soundplaying = false;
					soundlink.innerText = "turn on sound";
				});
			} catch(e) { z.tools.logerror("dashboard ::: suspendaudio " + e) }
		}
	});

	return radio;
})();
//test
z.radio.start(z);
z.radio.loadclips(z);

window.addEventListener('load', e => {
  z.radio.play(z);
  z.draw(z);
  window.scroll(0,0);
  window.setTimeout(() => { document.querySelector("#contentframe").style.opacity = 1.0 }, 1800);
  // window.setTimeout(() => { document.querySelector("#controls").style.backgroundColor = "rgba(0,0,0,0.0)" }, 6800);
});
window.addEventListener('beforeunload', e => {
	window.scroll(0,0);
});
</script>
</html>